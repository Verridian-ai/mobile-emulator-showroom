<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸ¤– AI Agent Factory - Mobile Device Testing Platform</title>
    <!-- Favicons - Using optimized PNG -->
    <link rel="icon" type="image/png" sizes="32x32" href="new_electronic_logo.optimized.png">
    <link rel="icon" type="image/png" sizes="16x16" href="new_electronic_logo.optimized.png">
    <link rel="apple-touch-icon" href="new_electronic_logo.optimized.png">
    <link rel="icon" type="image/png" href="new_electronic_logo.optimized.png">
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="device-skins.css">
    <link rel="stylesheet" href="verridian-theme.css">
    <link rel="stylesheet" href="verridian-production.css">
    <link rel="stylesheet" href="verridian-media-optimized.css">
    <link rel="stylesheet" href="screenshot-styles.css">
    
    <!-- Global Configuration -->
    <script src="js/config.js"></script>

    <!-- Scripts -->
    <script src="security-config.js" defer></script>
    <script src="performance-monitor.js" defer></script>

    <!-- Enhanced WebSocket Protocol Components -->
    <script src="websocket-broker-stability-agent.js" defer></script>
    <script src="enhanced-protocol-integration-bridge.js" defer></script>

    <!-- Browser Navigation Module -->
    <script src="js/browser-navigation.js" defer></script>

    <!-- html2canvas for screenshot capture -->
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

    <!-- Screenshot and IDE Integration Modules -->
    <script src="js/screenshot-capture.js" defer></script>
    <script src="js/ide-integration.js" defer></script>
    <script src="js/error-monitor.js" defer></script>
    <script src="js/screenshot-integration.js" defer></script>

    <!-- Removed dev-only Button Test Script -->
    <style>
        /* Override any conflicting base styles */
        .device-frame {
            transform: scale(0.8);
            transition: all 0.5s var(--transition-smooth);
        }
        
        .device-frame iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        
        @media (max-width: 768px) {
            .device-frame {
                transform: scale(0.6);
            }
        }

        /* Loader progress styles */
        .loader-progress {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 16px;
            width: min(420px, 80vw);
            margin-top: 20px;
            padding: 18px 20px;
            border-radius: 16px;
            background: rgba(10, 0, 32, 0.35);
            backdrop-filter: blur(14px) saturate(160%);
            -webkit-backdrop-filter: blur(14px) saturate(160%);
            border: 1px solid rgba(255,255,255,0.12);
            box-shadow: 0 12px 40px rgba(0,0,0,0.35), inset 0 1px 0 rgba(255,255,255,0.08);
        }
        .progress-ring { position: relative; filter: drop-shadow(0 0 16px rgba(107,70,193,0.6)) drop-shadow(0 0 28px rgba(37,99,235,0.5)); }
        .progress-ring svg { width: 180px; height: 180px; transform: rotate(-90deg); }
        .progress-ring .ring-bg { fill: none; stroke: rgba(255,255,255,0.12); stroke-width: 12; }
        .progress-ring .ring-fill { fill: none; stroke: url(#loaderGrad); stroke-width: 12; stroke-linecap: round; }
        .progress-ring::before {
            content: '';
            position: absolute; inset: -12px;
            border-radius: 999px;
            background: conic-gradient(from 0deg, rgba(255,255,255,0.0) 0deg, rgba(107,70,193,0.35) 60deg, rgba(37,99,235,0.35) 120deg, rgba(255,255,255,0.0) 180deg);
            filter: blur(10px);
            animation: loaderSpin 2.8s linear infinite;
            pointer-events: none; mix-blend-mode: screen;
        }
        .progress-ring .percent-text {
            position: absolute; inset: 0; display: flex; align-items: center; justify-content: center;
            font-family: 'BraveEightyone', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            font-size: 2rem; letter-spacing: 1px; text-shadow: 0 0 10px rgba(107,70,193,0.6), 0 0 18px rgba(37,99,235,0.5);
        }
        .progress-bar { width: 100%; height: 12px; border-radius: 999px; background: rgba(255,255,255,0.06); overflow: hidden; border: 1px solid rgba(255,255,255,0.15); box-shadow: inset 0 1px 0 rgba(255,255,255,0.08); }
        .progress-bar .progress-fill { position: relative; height: 100%; width: 0%; background: linear-gradient(90deg, #6B46C1, #2563EB); background-size: 200% 100%; box-shadow: 0 0 16px rgba(107,70,193,0.6); transition: width 120ms linear; animation: gradientMove 2.2s linear infinite; }
        .progress-bar .progress-fill::after { content: ''; position: absolute; inset: 0; background: repeating-linear-gradient(-45deg, rgba(255,255,255,0.22) 0 8px, rgba(255,255,255,0.0) 8px 16px); mix-blend-mode: overlay; animation: stripeMove 1s linear infinite; }
    </style>
</head>
<body>
    
    <div class="container">
        <!-- Premium Glass Header with Enhanced Depth System -->
        <header class="verridian-header glass-premium glass-crystal glass-depth-3" role="banner">
            <picture>
                <source srcset="new_electronic_logo.optimized.webp" type="image/webp">
                <img src="new_electronic_logo.optimized.png" alt="AI Agent Factory Logo" class="verridian-logo-enhanced" id="logo">
            </picture>
            <p class="verridian-subtitle">Device Testing Platform</p>
        </header>
        
        <!-- Main Control Section with Glass Hierarchy -->
        <main class="control-section">
            <!-- Browser Navigation Controls -->
            <div class="browser-nav-container">
                <div class="browser-nav-buttons">
                    <button id="backBtn" class="nav-btn glass-btn" title="Back (Alt+Left)" aria-label="Go back">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M19 12H5M12 19l-7-7 7-7"/>
                        </svg>
                    </button>
                    <button id="forwardBtn" class="nav-btn glass-btn" title="Forward (Alt+Right)" aria-label="Go forward">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M5 12h14M12 5l7 7-7 7"/>
                        </svg>
                    </button>
                    <button id="refreshBtn" class="nav-btn glass-btn" title="Refresh (Ctrl+R)" aria-label="Refresh page">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.2"/>
                        </svg>
                    </button>
                    <button id="homeBtn" class="nav-btn glass-btn" title="Home (Alt+Home)" aria-label="Go to home page">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                            <polyline points="9 22 9 12 15 12 15 22"/>
                        </svg>
                    </button>
                    <button id="stopBtn" class="nav-btn glass-btn stop-btn" title="Stop loading" aria-label="Stop loading" style="display: none;">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="6" y="6" width="12" height="12"/>
                        </svg>
                    </button>
                    <div class="nav-separator"></div>
                    <button id="screenshotBtn" class="nav-btn glass-btn screenshot-btn" title="Take Screenshot (Ctrl+Shift+S)" aria-label="Take screenshot">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/>
                            <circle cx="12" cy="13" r="4"/>
                        </svg>
                    </button>
                    <button id="inspectionBtn" class="nav-btn glass-btn inspection-btn" title="Element Inspection Mode (Ctrl+Shift+E)" aria-label="Toggle element inspection">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                            <path d="M2 17l10 5 10-5M2 12l10 5 10-5"/>
                        </svg>
                    </button>
                    <button id="screenshotSettingsBtn" class="nav-btn glass-btn settings-btn" title="Screenshot Settings" aria-label="Open screenshot settings">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="3"/>
                            <path d="M12 1v6m0 6v6M5.6 5.6l4.2 4.2m4.2 4.2l4.2 4.2M1 12h6m6 0h6M5.6 18.4l4.2-4.2m4.2-4.2l4.2-4.2"/>
                        </svg>
                    </button>
                    <button id="screenshotHistoryBtn" class="nav-btn glass-btn history-btn" title="Screenshot History" aria-label="View screenshot history">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <polyline points="12 6 12 12 16 14"/>
                        </svg>
                    </button>
                </div>
                <div class="browser-address-container">
                    <div class="loading-indicator" id="loadingIndicator">
                        <div class="loading-spinner"></div>
                    </div>
                    <input type="text" id="urlInput" class="url-input-cosmic browser-address-bar" placeholder="Enter URL or search query..." aria-label="Address bar">
                    <button id="urlSubmit" class="url-submit-btn">
                        <span>Go</span>
                    </button>
                </div>
            </div>
            
            <!-- Device Control Panel with Responsive Grid -->
            <div class="control-panel">
                <!-- iPhone Models with Premium Glass -->
                <div class="device-group-cosmic">
                    <h3 class="device-group-title">iPhone</h3>
                <button class="btn-cosmic" data-device="iphone-6">iPhone 6</button>
                <button class="btn-cosmic" data-device="iphone-7">iPhone 7</button>
                <button class="btn-cosmic" data-device="iphone-8">iPhone 8</button>
                <button class="btn-cosmic" data-device="iphone-x">iPhone X</button>
                <button class="btn-cosmic" data-device="iphone-11">iPhone 11</button>
                <button class="btn-cosmic" data-device="iphone-12">iPhone 12</button>
                <button class="btn-cosmic" data-device="iphone-13">iPhone 13</button>
                <button class="btn-cosmic" data-device="iphone-14">iPhone 14</button>
                <button class="btn-cosmic active" data-device="iphone-14-pro">iPhone 14 Pro</button>
                <button class="btn-cosmic" data-device="iphone-15">iPhone 15</button>
                <button class="btn-cosmic" data-device="iphone-15-pro">iPhone 15 Pro</button>
                <button class="btn-cosmic" data-device="iphone-16-pro">iPhone 16 Pro</button>
            </div>
            
            <!-- Samsung Galaxy with Enhanced Glass -->
            <div class="device-group-cosmic">
                <h3 class="device-group-title">Galaxy</h3>
                <button class="btn-cosmic" data-device="galaxy-s7">Galaxy S7</button>
                <button class="btn-cosmic" data-device="galaxy-s10">Galaxy S10</button>
                <button class="btn-cosmic" data-device="galaxy-s21">Galaxy S21</button>
                <button class="btn-cosmic" data-device="galaxy-s22">Galaxy S22</button>
                <button class="btn-cosmic" data-device="galaxy-s24">Galaxy S24</button>
                <button class="btn-cosmic" data-device="galaxy-s25-ultra">Galaxy S25 Ultra</button>
            </div>
            
            <!-- Google Pixel with Enhanced Glass -->
            <div class="device-group-cosmic">
                <h3 class="device-group-title">Pixel</h3>
                <button class="btn-cosmic" data-device="pixel-3">Pixel 3</button>
                <button class="btn-cosmic" data-device="pixel-5">Pixel 5</button>
                <button class="btn-cosmic" data-device="pixel-7">Pixel 7</button>
                <button class="btn-cosmic" data-device="pixel-8">Pixel 8</button>
                <button class="btn-cosmic" data-device="pixel-9-pro">Pixel 9 Pro</button>
            </div>
            
            <!-- iPads with Enhanced Glass -->
            <div class="device-group-cosmic">
                <h3 class="device-group-title">iPad</h3>
                <button class="btn-cosmic" data-device="ipad-air-2022">iPad Air 2022</button>
                <button class="btn-cosmic" data-device="ipad-pro-13-m4">iPad Pro 13" M4</button>
            </div>
            
            <!-- Desktop with Enhanced Glass -->
            <div class="device-group-cosmic">
                <h3 class="device-group-title">Desktop</h3>
                <button class="btn-cosmic" data-device="desktop-chrome">Desktop Chrome</button>
            </div>
        </div>
        </main>
        
        <!-- Device Showcase Section with Premium Glass -->
        <section class="device-showcase-cosmic glass-dark glass-depth-2">
            <div id="deviceFrame" class="device-mockup device-iphone-14-pro scale-75 animate-hover">
                <div class="screen">
                    <iframe id="deviceIframe" src="https://google.com"></iframe>
                </div>
            </div>
        </section>
    </div>

    <!-- Screenshot Settings Modal -->
    <div id="screenshotSettingsModal" class="modal-overlay" style="display: none;">
        <div class="modal-content glass-dark glass-depth-3">
            <div class="modal-header">
                <h3>Screenshot Settings</h3>
                <button class="close-modal-btn" aria-label="Close settings">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="setting-group">
                    <label for="captureMode">Capture Mode</label>
                    <select id="captureMode" class="settings-select">
                        <option value="full">Full Device Frame</option>
                        <option value="viewport">Viewport Only</option>
                    </select>
                </div>
                <div class="setting-group">
                    <label for="imageFormat">Image Format</label>
                    <select id="imageFormat" class="settings-select">
                        <option value="png">PNG (Lossless)</option>
                        <option value="jpeg">JPEG (Smaller)</option>
                        <option value="webp">WebP (Modern)</option>
                    </select>
                </div>
                <div class="setting-group">
                    <label for="imageQuality">Image Quality</label>
                    <input type="range" id="imageQuality" min="0.1" max="1" step="0.05" value="0.92">
                    <span id="qualityValue">92%</span>
                </div>
                <div class="setting-group">
                    <label>
                        <input type="checkbox" id="autoScreenshotOnError" checked>
                        Auto-capture on errors
                    </label>
                </div>
                <div class="setting-group">
                    <label for="preferredIDE">Preferred IDE</label>
                    <select id="preferredIDE" class="settings-select">
                        <option value="">Auto-detect</option>
                        <option value="claudeCode">Claude Code</option>
                        <option value="vsCode">VS Code</option>
                        <option value="cursor">Cursor</option>
                        <option value="filesystem">Filesystem</option>
                    </select>
                </div>
                <div class="setting-group ide-status">
                    <p id="ideStatus">Detecting IDE...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Screenshot History Modal -->
    <div id="screenshotHistoryModal" class="modal-overlay" style="display: none;">
        <div class="modal-content glass-dark glass-depth-3 history-modal">
            <div class="modal-header">
                <h3>Screenshot History</h3>
                <button class="close-modal-btn" aria-label="Close history">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div id="screenshotHistoryList" class="screenshot-history-list">
                    <!-- Screenshots will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Main Application Logic (CSP Compliant) -->
    <script src="js/main-app.js" defer></script>
</body>
</html>